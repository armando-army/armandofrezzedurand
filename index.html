import React, { useEffect, useRef } from "react";
import { Download } from "lucide-react";
import * as THREE from "three";
import { OBJLoader } from "three/examples/jsm/loaders/OBJLoader.js";
import { AsciiEffect } from "three/examples/jsm/effects/AsciiEffect.js";

export default function ArmandoPortfolio() {
  const asciiMountRef = useRef(null);

  useEffect(() => {
    if (!asciiMountRef.current) return;

    // 1) URL del OBJ (RAW de GitHub)
    // Ejemplo:
    // https://raw.githubusercontent.com/TU_USUARIO/TU_REPO/main/FRANCO_LowPoly.obj
    const OBJ_URL =
      "https://raw.githubusercontent.com/armando-army/armandofrezzedurand/refs/heads/main/FRANCO_LowPoly.obj";

    // Scene / Camera
    const scene = new THREE.Scene();
    scene.background = null;

    const camera = new THREE.PerspectiveCamera(
      55,
      asciiMountRef.current.clientWidth / asciiMountRef.current.clientHeight,
      0.1,
      2000
    );
    camera.position.set(0, 1.2, 4.5);

    // WebGL Renderer (base)
    const renderer = new THREE.WebGLRenderer({
      alpha: true,
      antialias: true,
    });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    // ASCII Effect
    // Cambiá la "paleta" de chars si querés más/menos densidad
    const effect = new AsciiEffect(renderer, " .:-=+*#%@", {
      invert: true,
    });

    // Montaje del ASCII (reemplaza el canvas: es un <pre>)
    effect.domElement.style.color = "#000";
    effect.domElement.style.backgroundColor = "transparent";
    effect.domElement.style.fontFamily =
      'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    effect.domElement.style.fontSize = "10px";
    effect.domElement.style.lineHeight = "10px";
    effect.domElement.style.letterSpacing = "0px";
    effect.domElement.style.userSelect = "none";
    effect.domElement.style.width = "100%";
    effect.domElement.style.height = "100%";

    asciiMountRef.current.appendChild(effect.domElement);

    // Luces (importante para que el OBJ “lea” bien en ASCII)
    const key = new THREE.DirectionalLight(0xffffff, 1.1);
    key.position.set(3, 4, 2);
    scene.add(key);

    const fill = new THREE.DirectionalLight(0xffffff, 0.6);
    fill.position.set(-3, 2, 3);
    scene.add(fill);

    const ambient = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambient);

    // Grupo contenedor del OBJ
    const group = new THREE.Group();
    scene.add(group);

    // Loader OBJ
    const loader = new OBJLoader();

    let loadedObject = null;

    loader.load(
      OBJ_URL,
      (obj) => {
        loadedObject = obj;

        // Material base (para lectura de luz/volumen)
        obj.traverse((child) => {
          if (child.isMesh) {
            child.material = new THREE.MeshStandardMaterial({
              color: 0xffffff,
              metalness: 0.0,
              roughness: 1.0,
            });
            child.castShadow = false;
            child.receiveShadow = false;
          }
        });

        // Centramos y escalamos para que encuadre bien
        const box = new THREE.Box3().setFromObject(obj);
        const size = new THREE.Vector3();
        box.getSize(size);
        const center = new THREE.Vector3();
        box.getCenter(center);

        obj.position.sub(center); // centra en 0,0,0

        // Escala automática (ajusta si querés más grande/chico)
        const maxDim = Math.max(size.x, size.y, size.z);
        const scale = 2.2 / (maxDim || 1); // 2.2 es “zoom” relativo
        obj.scale.setScalar(scale);

        // Levantamos un toque en Y (opcional)
        obj.position.y += 0.1;

        group.add(obj);
      },
      undefined,
      (err) => {
        console.error("Error cargando OBJ:", err);
      }
    );

    // Size
    const setSize = () => {
      const w = asciiMountRef.current.clientWidth;
      const h = asciiMountRef.current.clientHeight;

      camera.aspect = w / h;
      camera.updateProjectionMatrix();

      renderer.setSize(w, h);
      effect.setSize(w, h);
    };

    setSize();

    // Animación
    let rafId = 0;
    const animate = () => {
      rafId = requestAnimationFrame(animate);

      // Giro suave (si no cargó aún, rota el grupo igual)
      group.rotation.y += 0.004;

      // Un pequeño “tilt” para que lea mejor el volumen
      group.rotation.x = -0.08;

      effect.render(scene, camera);
    };

    animate();

    // Resize
    const handleResize = () => setSize();
    window.addEventListener("resize", handleResize);

    // Cleanup
    return () => {
      window.removeEventListener("resize", handleResize);
      cancelAnimationFrame(rafId);

      // sacar el domElement del effect
      if (asciiMountRef.current && effect.domElement?.parentNode) {
        effect.domElement.parentNode.removeChild(effect.domElement);
      }
      renderer.dispose();
    };
  }, []);

  const works = [
    // ... dejé tu grilla tal cual (podés reemplazar las imágenes después)
    {
      title: "Army of Us 02",
      year: "2023",
      material: "Fibra de vidrio · pintura industrial",
      dimensions: "95 × 48 × 42 cm",
      image:
        "https://images.unsplash.com/photo-1578926288207-a90a5366759d?w=1200&q=80",
    },
    {
      title: "Army of Us 03",
      year: "2024",
      material: "Fibra de vidrio · pintura industrial",
      dimensions: "110 × 50 × 45 cm",
      image:
        "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=1200&q=80",
    },
    {
      title: "Army of Us 04",
      year: "2024",
      material: "Fibra de vidrio · pintura industrial",
      dimensions: "88 × 44 × 38 cm",
      image:
        "https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?w=1200&q=80",
    },
    {
      title: "Army of Us 05",
      year: "2023",
      material: "Fibra de vidrio · pintura industrial",
      dimensions: "102 × 52 × 43 cm",
      image:
        "https://images.unsplash.com/photo-1549887534-1541e9326642?w=1200&q=80",
    },
    {
      title: "Army of Us 06",
      year: "2024",
      material: "Fibra de vidrio · pintura industrial",
      dimensions: "98 × 46 × 41 cm",
      image:
        "https://images.unsplash.com/photo-1577083552431-6e5fd01988ec?w=1200&q=80",
    },
    {
      title: "Army of Us 07",
      year: "2023",
      material: "Fibra de vidrio · pintura industrial",
      dimensions: "92 × 47 × 39 cm",
      image:
        "https://images.unsplash.com/photo-1515377905703-c4788e51af15?w=1200&q=80",
    },
  ];

  return (
    <div
      className="min-h-screen bg-white"
      style={{
        fontFamily:
          '-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif',
      }}
    >
      {/* Header / Identidad */}
      <header className="fixed top-0 left-0 right-0 z-50 px-6 md:px-16 lg:px-24 py-6 md:py-8 bg-white bg-opacity-95">
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <div>
            <h1 className="text-lg md:text-xl font-light tracking-tight">
              Armando Frezze Durand
            </h1>
            <p className="text-xs md:text-sm text-gray-600 font-light">
              Imagen · tecnología · materialidad
            </p>
          </div>
        </div>
      </header>

      {/* Hero Section with ASCII OBJ */}
      <section className="relative h-screen flex items-center justify-center overflow-hidden">
        <div
          ref={asciiMountRef}
          className="absolute inset-0"
          style={{
            width: "100%",
            height: "100%",
          }}
        />
        <div className="relative z-10 text-center px-6">
          <h2 className="text-5xl md:text-7xl lg:text-8xl font-light tracking-tight mb-4">
            FRANCO
          </h2>
          <p className="text-lg md:text-xl text-gray-600 font-light">
            LowPoly OBJ · ASCII render
          </p>
        </div>
      </section>

      {/* Obra Principal */}
      <section className="min-h-screen flex items-center justify-center px-6 md:px-16 lg:px-24 py-32">
        <div className="max-w-7xl w-full">
          <div className="mb-8">
            <img
              src="https://images.unsplash.com/photo-1547826039-bfc35e0f1ea8?w=1600&q=80"
              alt="Army of Us 01"
              className="w-full h-auto"
            />
          </div>
          <div className="text-left max-w-md">
            <p className="text-sm md:text-base leading-relaxed text-gray-700 font-light">
              Army of Us 01, 2023
              <br />
              Fibra de vidrio · pintura industrial
              <br />
              90 × 45 × 40 cm
            </p>
          </div>
        </div>
      </section>

      {/* Grilla de Obras */}
      <section className="px-6 md:px-16 lg:px-24 py-32 max-w-7xl mx-auto">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12 md:gap-16 lg:gap-20">
          {works.map((work, index) => (
            <div key={index}>
              <div className="mb-6">
                <img src={work.image} alt={work.title} className="w-full h-auto" />
              </div>
              <div className="text-left">
                <p className="text-sm leading-relaxed text-gray-700 font-light">
                  {work.title}, {work.year}
                  <br />
                  {work.material}
                  <br />
                  {work.dimensions}
                </p>
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* Statement Section con fondo oscuro */}
      <section className="bg-black text-white px-6 md:px-16 lg:px-24 py-32">
        <div className="max-w-4xl mx-auto">
          <h2 className="text-xs md:text-sm uppercase tracking-widest mb-16 opacity-60 font-light">
            Statement
          </h2>

          <div className="space-y-8 text-base md:text-lg leading-relaxed font-light">
            <p>
              La práctica de Armando Frezze Durand se construye en el cruce entre la
              imagen, la tecnología y la materialidad. Su trabajo parte de la fotografía
              y el audiovisual —del laboratorio analógico al entorno digital— para
              desplazarse hacia procesos de escaneo, manipulación y traducción de
              imágenes en cuerpos físicos. La escultura aparece aquí no como punto de
              partida, sino como consecuencia de un recorrido que atraviesa lo online y
              lo offline, lo virtual y lo tangible.
            </p>
            <p>
              En este tránsito, el cuerpo humano —particularmente el cuerpo masculino—
              funciona como una operación de desplazamiento. Cuerpos e imágenes
              provenientes del flujo cotidiano —personajes anónimos, presencias
              irrelevantes dentro de las jerarquías culturales— son traducidos a materia
              con la intención de persistir en el tiempo. En esa traslación se activa
              una tensión constante entre representación, deseo y artificio tecnológico.
            </p>
            <p>
              Esta materialización introduce una pregunta incómoda: ¿qué cuerpos, qué
              imágenes y qué relatos merecen ser conservados? Al otorgar duración y peso
              escultórico a figuras sin jerarquía aparente, la obra tensiona las nociones
              de relevancia, valor e idealización, y expone el carácter arbitrario de
              aquello que una cultura decide monumentalizar, reproducir o multiplicar.
            </p>
            <p>
              La repetición opera en la obra como un método. Un mismo cuerpo, una misma
              imagen o un mismo individuo reaparece a lo largo del tiempo bajo distintas
              formas —fotografía, video, escultura, relieve—, desplazado y reescrito en
              cada nueva traducción material. Esta insistencia no busca fijar un ícono,
              sino erosionarlo: volver a interrogar su vigencia, su carga simbólica y su
              relación con el tiempo. La repetición no garantiza permanencia; la
              interpela.
            </p>
            <p>
              Entre imagen y materia, la práctica de Frezze Durand no busca cerrar
              sentidos, sino habilitar preguntas sobre qué conservamos, por qué lo
              hacemos y qué dejamos caer en el proceso. Un gesto de fricción frente a la
              lógica del desplazamiento constante y el consumo infinito de imágenes.
            </p>
          </div>
        </div>
      </section>

      {/* Botón PDF */}
      <section className="px-6 md:px-16 lg:px-24 py-32 max-w-7xl mx-auto">
        <a
          href="#"
          target="_blank"
          rel="noopener noreferrer"
          className="inline-flex items-center gap-3 bg-black text-white px-8 py-4 text-sm uppercase tracking-wider hover:bg-gray-900 transition-colors font-light"
        >
          <Download size={18} />
          Descargar Portfolio – Escultura
        </a>
      </section>

      {/* Contacto */}
      <section className="px-6 md:px-16 lg:px-24 py-32 max-w-7xl mx-auto border-t border-gray-200">
        <div className="text-left space-y-1 text-sm md:text-base text-gray-700 font-light">
          <p>Armando Frezze Durand</p>
          <p>Buenos Aires, Argentina</p>
          <p>
            <a
              href="mailto:armando@dooplerstudio.com.ar"
              className="hover:text-black transition-colors"
            >
              armando@dooplerstudio.com.ar
            </a>
          </p>
          <p>+54 9 11 6559 8444</p>
        </div>
      </section>
    </div>
  );
}
